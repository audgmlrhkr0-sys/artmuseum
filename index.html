<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <meta name="screen-orientation" content="landscape">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <title>미술관 아카이브 러너</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <!-- 게임 시작 화면 -->
    <div id="startScreen" class="start-screen">
        <div class="start-content">
            <h1>미술관 아카이브 러너</h1>
            <p>포스터를 수집하고 챕터를 완료하세요!</p>
            <button id="startBtn" class="start-btn" onclick="alert('버튼 클릭됨!'); beginGame(); return false;" style="pointer-events: auto !important; position: relative; z-index: 2002;">게임 시작</button>
        </div>
    </div>

    <div id="gameContainer" class="hidden">
        <div id="score">점수: 0</div>
        <div id="gameCanvas"></div>
        <div id="gameOver" class="hidden">
            <h2>게임 오버!</h2>
            <p>최종 점수: <span id="finalScore">0</span></p>
            <button id="restartBtn">다시 시작</button>
        </div>
        
        <!-- 모바일 터치 컨트롤 -->
        <div id="mobileControls" class="mobile-controls hidden">
            <!-- 좌측 상단: 방향키 키패드 -->
            <div id="dpad" class="dpad">
                <div class="dpad-grid">
                    <div class="dpad-cell"></div>
                    <button id="btnUp" class="dpad-btn dpad-up">↑</button>
                    <div class="dpad-cell"></div>
                    <button id="btnLeft" class="dpad-btn dpad-left">←</button>
                    <div class="dpad-cell"></div>
                    <button id="btnRight" class="dpad-btn dpad-right">→</button>
                    <div class="dpad-cell"></div>
                    <button id="btnDown" class="dpad-btn dpad-down">↓</button>
                    <div class="dpad-cell"></div>
                </div>
            </div>
            
            <!-- 우측: 점프 및 아이템 줍기 버튼 -->
            <div class="action-buttons">
                <button id="btnJump" class="action-btn jump-btn">점프</button>
                <button id="btnCollect" class="action-btn collect-btn">줍기</button>
            </div>
        </div>
    </div>

    <!-- 포스터 모달 -->
    <div id="posterModal" class="modal hidden">
        <div class="modal-content">
            <span class="close">&times;</span>
            <h2 id="posterTitle"></h2>
            <div id="posterImageContainer">
                <img id="posterImage" src="" alt="포스터">
            </div>
            <p id="posterDescription"></p>
            <button id="continueBtn">계속하기</button>
        </div>
    </div>

    <script>
        // 즉시 실행 함수로 beginGame 정의
        function beginGame() {
            console.log('beginGame 호출됨 - 인라인 스크립트');
            
            // 시작 화면 숨기기
            const startScreen = document.getElementById('startScreen');
            if (startScreen) {
                startScreen.classList.add('hidden');
                startScreen.style.display = 'none';
                console.log('시작 화면 숨김');
            }
            
            // 게임 컨테이너 표시
            const gameContainer = document.getElementById('gameContainer');
            if (gameContainer) {
                gameContainer.classList.remove('hidden');
                gameContainer.style.display = 'block';
                gameContainer.style.visibility = 'visible';
                gameContainer.style.opacity = '1';
                console.log('게임 컨테이너 표시');
            } else {
                console.error('게임 컨테이너를 찾을 수 없습니다!');
                return;
            }
            
            // 모바일 컨트롤 표시
            const mobileControls = document.getElementById('mobileControls');
            if (mobileControls) {
                mobileControls.classList.remove('hidden');
                mobileControls.style.display = 'block';
                console.log('모바일 컨트롤 표시');
            }
            
            // 전체 화면 시도 (모바일/데스크톱 모두)
            function enterFullscreen() {
                const element = document.documentElement;
                if (element.requestFullscreen) {
                    return element.requestFullscreen().catch(() => {
                        console.log('전체 화면 API 실패');
                        return false;
                    });
                } else if (element.webkitRequestFullscreen) {
                    element.webkitRequestFullscreen();
                    return Promise.resolve();
                } else if (element.mozRequestFullScreen) {
                    element.mozRequestFullScreen();
                    return Promise.resolve();
                } else if (element.msRequestFullscreen) {
                    element.msRequestFullscreen();
                    return Promise.resolve();
                }
                return Promise.resolve();
            }
            
            // 전체화면 진입 시도
            enterFullscreen().then(() => {
                console.log('전체화면 진입 완료');
            }).catch(() => {
                console.log('전체화면 실패, CSS로 처리');
            });
            
            // 모바일 가로 모드 강제
            if (screen.orientation && screen.orientation.lock) {
                screen.orientation.lock('landscape').catch(() => {
                    console.log('화면 회전 잠금 실패');
                });
            }
            
            // 게임 시작 (main.js의 startGame 함수 호출) - 약간의 지연 후 호출
            setTimeout(function() {
                console.log('startGame 함수 확인 중...');
                if (typeof startGame === 'function') {
                    console.log('startGame 함수 호출');
                    try {
                        startGame();
                        console.log('startGame 실행 완료');
                    } catch (e) {
                        console.error('startGame 실행 오류:', e);
                        alert('게임 시작 중 오류: ' + e.message);
                    }
                } else {
                    console.error('startGame 함수를 찾을 수 없습니다!');
                    // 재시도 로직
                    let retryCount = 0;
                    const retryInterval = setInterval(function() {
                        retryCount++;
                        if (typeof startGame === 'function') {
                            console.log('재시도 ' + retryCount + ': startGame 함수 호출');
                            clearInterval(retryInterval);
                            try {
                                startGame();
                            } catch (e) {
                                console.error('startGame 실행 오류:', e);
                            }
                        } else if (retryCount >= 30) {
                            console.error('startGame 함수를 찾을 수 없습니다! (30회 시도)');
                            clearInterval(retryInterval);
                            alert('게임을 시작할 수 없습니다. 페이지를 새로고침해주세요.');
                        }
                    }, 100);
                }
                
                // 모바일 컨트롤 초기화
                setTimeout(function() {
                    if (typeof initMobileControls === 'function') {
                        console.log('모바일 컨트롤 초기화');
                        initMobileControls();
                    }
                }, 1000);
            }, 300);
        }
        
        // 페이지 로드 확인
        console.log('HTML 스크립트 로드됨');
        
        // DOM 로드 후 확인
        window.addEventListener('DOMContentLoaded', function() {
            console.log('DOM 로드 완료');
            const startBtn = document.getElementById('startBtn');
            console.log('시작 버튼 요소:', startBtn);
            
            if (startBtn) {
                startBtn.onclick = function(e) {
                    e.preventDefault();
                    console.log('버튼 클릭 이벤트 발생');
                    beginGame();
                    return false;
                };
                console.log('onclick 이벤트 설정 완료');
            }
        });
    </script>
    <script src="main.js"></script>
</body>
</html>

